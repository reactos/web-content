---
title:       "USB 1.1 UHCI improvements GSoC - Week 1"
author:      "VardanM"
date:        2016-05-30
aliases:     [ /node/10382 ]
tags:        [ gsoc ]

---

<p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span style="color: rgb(0, 0, 0); font-family: Arial; font-size: 14.6667px; line-height: 1.38; white-space: pre-wrap; background-color: transparent;">Hi! My name is Vardan and during this GSoC I&#39;ll work on UHCI driver improvements.</span></p><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;">&nbsp;</p><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;">&nbsp;</p><h3><strong><span style="color: rgb(0, 0, 0); font-family: Arial; font-size: 14.6667px; line-height: 1.38; white-space: pre-wrap; background-color: transparent;">Why ROS?</span></strong></h3><p><span style="color: rgb(0, 0, 0); font-family: Arial; font-size: 14.6667px; white-space: pre-wrap; line-height: 1.38; background-color: transparent;">Now, when human is becoming more and more dependent on computer it becoming critical to have open-source OS on it. You can feel really secured only when you&lsquo;re able (allowed) to see any part of OS which can control all your data. For the student who is studying computer science, the best choice was Linux (especially when classroom computers working only under it). I have dived into Linux kernel and have done some investigation of it, especially on USB stack. Kernel development became my passion, because here you&rsquo;re understanding the basics and becoming a really generic programmer who can easily switch to any sphere of programming market. Despite the fact that before this time I was worked only in Linux environment, I don&rsquo;t think that I am true Linuxoid, I think I am &ldquo;openSourceOSoid&rdquo; who think that he can do something to contribute open source. After some investigation of open source OS field I&rsquo;ve found that there is very few choice between Linux and Linux :D. Also I have found ReactOS, but I never dared to dig deeper into it. Maybe because NT internals were absolutely new for me. So I was only following some blogs and publications about ROS. The main place of info was &lsquo;habr&rdquo; (Russian-language site). When I saw that ROS is accepted for GSoC it was the pulse for me, I say to myself &ldquo;It&rsquo;s time to start investigation of NT kernel !!! &rdquo;.</span></p><p><strong><span style="color: rgb(0, 0, 0); font-family: Arial; font-size: 14.6667px; white-space: pre-wrap; line-height: 1.38; background-color: transparent;">Status</span></strong></p><p><span style="color: rgb(0, 0, 0); font-family: Arial; font-size: 14.6667px; white-space: pre-wrap; line-height: 1.38; background-color: transparent;">In this post I have provided my status for community bonding period and week of coding. The points are described as steps, next reports will be much shorter.</span></p><ul style="margin-top: 0pt; margin-bottom: 0pt;"><li dir="ltr" style="list-style-type: disc; font-size: 14.6667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Setup working environment for ROS.</span></span></p></li></ul><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt; margin-left: 40px;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Installed RosBE, compiled and ran latest version of ROS codes on VBox and Vmware virtual machines (there is different USB 1.1 controllers). Investigated ROS debugging methods. Setup debugging environment for ROS. Faced issue with command line debugger, it switches to debug mode but screen freezes in GUI and no terminal is seen. Anytime I was able to run debugging commands on freezed VM and saw them in putty connected to VM via COM port.</span></span></p><ul style="margin-top: 0pt; margin-bottom: 0pt;"><li dir="ltr" style="list-style-type: disc; font-size: 14.6667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Setup working environment for Windows 2k3.</span><br class="kix-line-break" /><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Prepared vdisk images with retail and partly checked versions of 2k3. Done </span><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">initial testing of USB drivers from ROS in Win 2k3 virtual environment on </span><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Vmware and VBox.</span></span></p></li><li dir="ltr" style="list-style-type: disc; font-size: 14.6667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Participated in ReactOS team&rsquo;s monthly meeting in IRC.</span><br class="kix-line-break" /><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Introduced myself and my project. Got familiar with reporting style of ROS </span><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">community.</span></span></p></li><li dir="ltr" style="list-style-type: disc; font-size: 14.6667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Prepared test plan and sent it for review.</span></span></p></li></ul><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt; margin-left: 40px;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">I have planned to test ROS host controller drivers by injecting them separately into win2k3 USB stack. I have prepared smoke test spreadsheets for each controller (OHCI,UHCI,EHCI) and sent it to Thomas for review. He suggested to inject ros-usbhub too. So we decided to do both with usbhub injected too and with only usb?chi. This will allow to have overview of </span></span><span style="color: rgb(0, 0, 0); font-family: Arial; font-size: 14.6667px; white-space: pre-wrap;">inconsistencies within ROS&#39;s hcd-hub pair and same pair of 2k3.</span></p><ul style="margin-top: 0pt; margin-bottom: 0pt;"><li dir="ltr" style="list-style-type: disc; font-size: 14.6667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Investigated Windows NT architecture.</span><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> (<b>The biggest part of time</b></span><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">)</span></span></p><ul style="margin-top: 0pt; margin-bottom: 0pt;"><li style="list-style-type: circle; font-size: 14.6667px; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Concepts and Tools</span></span></p></li><li style="list-style-type: circle; font-size: 14.6667px; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">System Architecture</span></span></p></li><li style="list-style-type: circle; font-size: 14.6667px; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">System Mechanisms</span></span></p></li><li style="list-style-type: circle; font-size: 14.6667px; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Management Mechanisms</span></span></p></li><li style="list-style-type: circle; font-size: 14.6667px; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Startup and Shutdown</span></span></p></li><li style="list-style-type: circle; font-size: 14.6667px; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Processes, Threads, and Jobs</span></span></p></li><li style="list-style-type: circle; font-size: 14.6667px; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Memory management</span></span></p></li><li style="list-style-type: circle; font-size: 14.6667px; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">I/O subsystem</span></span></p></li></ul></li><li dir="ltr" style="list-style-type: disc; font-size: 14.6667px; font-family: Arial; color: rgb(0, 0, 0); font-weight: 700; vertical-align: baseline; background-color: transparent;"><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-18efaa1b-0178-5adb-d5f8-3a8d0a872b6b"><span style="font-size: 14.6667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Done ROS&rsquo;s USB host controller drivers testing,</span><br class="kix-line-break" /><span style="font-size: 14.6667px; font-weight: 400; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Tested ROS&rsquo;s OHCI, UHCI and EHCI drivers. Tested by driver injection into Win2k3 usb s</span><span style="font-size: 14.6667px; font-weight: 400; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">tack see corresponding spreadsheets below. Here is presented resulsts only for ROS&#39;s hcd injection int 2k3 stack, without hub. Results for hcd-hub pair injection will be presented in next post.</span></span><img alt="Image" class="imgp_img" src="/sites/default/files/imagepicker/49145/Testing_on_Win2k3-page-001.jpg" style="font-size: 14.6667px; width: 640px; height: 284px; background-color: transparent;" /><img alt="Image" class="imgp_img" src="/sites/default/files/imagepicker/49145/Testing_on_Win2k3-page-002.jpg" style="font-size: 14.6667px; line-height: 1.38; width: 600px; height: 302px; background-color: transparent;" /><img alt="Image" class="imgp_img" src="/sites/default/files/imagepicker/49145/Testing_on_Win2k3-page-003_0.jpg" style="font-size: 14.6667px; width: 600px; height: 254px; background-color: transparent;" /></p></li></ul>
